ğŸš¨ PROMPT PARA IA â€” REFORMULE O SISTEMA DE AFILIAÃ‡ÃƒO (ERRO PERSISTE)
ATENÃ‡ÃƒO, IA.
Mesmo apÃ³s os ajustes solicitados, o erro crÃ­tico persiste: ao criar uma casa de apostas via painel admin, o usuÃ¡rio eaidavid1 (e possivelmente outros) continua sendo automaticamente afiliado, sem clicar em â€œSe Afiliarâ€.

JÃ¡ testamos e esse comportamento nÃ£o ocorre quando a casa Ã© criada via cÃ³digo ou diretamente no banco â€” apenas quando Ã© criada via interface administrativa.

âŒ ESTE COMPORTAMENTO Ã‰ INACEITÃVEL:
Nenhum usuÃ¡rio deve ser afiliado automaticamente Ã  casa no momento da criaÃ§Ã£o.

A afiliaÃ§Ã£o sÃ³ deve acontecer apÃ³s o clique explÃ­cito no botÃ£o â€œSe Afiliarâ€, no painel do usuÃ¡rio.

A verificaÃ§Ã£o deve ser real no banco de dados, e o vÃ­nculo sÃ³ deve ser criado se nÃ£o houver registro prÃ©vio em afiliacoes.

âœ… SOLICITAÃ‡ÃƒO CLARA:
PeÃ§o que reformule completamente o sistema de afiliaÃ§Ã£o, corrigindo definitivamente o fluxo de criaÃ§Ã£o de casas e afiliaÃ§Ã£o, conforme as seguintes regras:

ğŸ› ï¸ NOVO FLUXO QUE DEVE SER IMPLEMENTADO:
1. CriaÃ§Ã£o da Casa (pelo Admin):
Ao preencher o formulÃ¡rio no painel admin e clicar em â€œCriar Casaâ€:

A casa deve ser salva somente na tabela casas.

Nenhum vÃ­nculo com usuÃ¡rios deve ser criado.

Nenhuma entrada na tabela afiliacoes deve ser gerada.

Nenhum link promocional com ID de usuÃ¡rio deve ser montado neste momento.

2. Painel do UsuÃ¡rio:
Ao exibir as casas:

Se o usuÃ¡rio nÃ£o estiver afiliado (SELECT * FROM afiliacoes WHERE id_user = :user_id AND id_casa = :casa_id):

Exibir botÃ£o â€œSe Afiliarâ€.

Se o usuÃ¡rio estiver afiliado:

Exibir status â€œAfiliadoâ€ e botÃ£o â€œCopiar Linkâ€.

3. AfiliaÃ§Ã£o:
Quando o usuÃ¡rio clicar em â€œSe Afiliarâ€:

O sistema verifica no banco se ele jÃ¡ estÃ¡ afiliado.

Se nÃ£o estiver:

Cria a entrada na tabela afiliacoes com id_user, id_casa, link_gerado.

Gera o link personalizado substituindo VALUE pelo ID do usuÃ¡rio (ou outro identificador definido).

Atualiza a interface dinamicamente com o novo estado.

ğŸ“Œ PEDIDO FINAL:
Reformule esse fluxo desde a criaÃ§Ã£o da casa no painel admin atÃ© a exibiÃ§Ã£o correta no painel do usuÃ¡rio, garantindo que:

âŒ Nenhum usuÃ¡rio seja afiliado automaticamente.

âœ… A afiliaÃ§Ã£o sÃ³ ocorra por aÃ§Ã£o manual do usuÃ¡rio.

âœ… Toda verificaÃ§Ã£o seja feita por consulta real ao banco.

âœ… O painel se comporte corretamente conforme o estado de afiliaÃ§Ã£o.

