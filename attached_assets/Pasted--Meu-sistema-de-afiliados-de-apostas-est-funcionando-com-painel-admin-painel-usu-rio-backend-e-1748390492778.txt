‚öôÔ∏è Meu sistema de afiliados de apostas est√° funcionando, com painel admin, painel usu√°rio, backend em Node.js + Express e banco PostgreSQL.
O sistema j√° gera links promocionais exclusivos por afiliado.

Agora preciso que voc√™ implemente todo o sistema de postbacks, com as seguintes exig√™ncias avan√ßadas:

üß© FUNCIONALIDADES PRINCIPAIS
1. CRIA√á√ÉO DE CASA COM CONFIGURA√á√ÉO DIN√ÇMICA DE POSTBACKS
Ao cadastrar uma nova casa pelo painel admin:

Mostrar uma lista de eventos poss√≠veis via checkbox:

Registro (registration)

Primeiro Dep√≥sito (first_deposit)

Dep√≥sito (deposit)

Lucro (profit)

O admin marca apenas os que a casa envia.

O sistema deve:

Gerar um postback diferente para cada evento, contendo o identificador da casa, por exemplo:

ruby
Copiar
Editar
https://meusite.com/postback/brazzino/registration?subid={subid}
https://meusite.com/postback/brazzino/deposit?subid={subid}&amount={amount}
https://meusite.com/postback/brazzino/profit?subid={subid}&amount={amount}
Salvar os postbacks habilitados no banco junto com a casa.

Exibir uma tela com os links prontos para copiar e colar na plataforma da casa (ex: lista com bot√£o ‚ÄúCopiar URL‚Äù).

Exibir notifica√ß√£o de sucesso ao criar a casa e redirecionar para uma p√°gina tipo /admin/casas/:id/postbacks com os links.

2. ROTAS P√öBLICAS DE POSTBACK
Para cada evento criado, o sistema deve criar rotas como:

ts
Copiar
Editar
GET /postback/:identificador/:evento
Essa rota:

Valida o subid (e amount se necess√°rio)

Valida se a casa aceita esse tipo de postback

Registra o evento no banco

Calcula comiss√£o:

CPA para registro / first_deposit

RevShare para deposit / profit

Salva log completo com:

Identificador da casa

Evento

Dados recebidos

Timestamp

Status ("OK", "INVALID_SUBID", etc.)

3. INTEGRA√á√ÉO NO PAINEL ADMIN
P√°gina de cria√ß√£o de casa com os checkboxes dos eventos

P√°gina p√≥s-cria√ß√£o com:

Lista dos URLs gerados para cada postback ativado

Bot√£o ‚ÄúCopiar link‚Äù

Status: ‚ÄúAguardando chamadas‚Äù ou ‚ÄúChamadas recebidas‚Äù

P√°gina de logs:

Filtro por casa, evento, status

Exibe todos os postbacks recebidos

4. INTEGRA√á√ÉO NO PAINEL DO AFILIADO
Aba ‚ÄúMinhas Atividades‚Äù:

Lista com tipo de evento, valor (se houver), data

Aba ‚ÄúMinhas Comiss√µes‚Äù:

Total CPA, total RevShare, comiss√£o acumulada

Mostrar quais casas o afiliado est√° vinculado e os eventos rastreados

‚úÖ ESTRUTURA SUGERIDA NO BANCO DE DADOS
sql
Copiar
Editar
CASAS
- id
- nome
- identificador
- parametros_comissao (json)
- eventos_habilitados (json)

POSTBACKS
- id
- casa_id
- evento
- subid
- valor (nullable)
- tipo_comissao (CPA ou RevShare)
- valor_comissao
- raw_data
- status
- criado_em

COMISSOES
- id
- afiliado_id
- postback_id
- tipo
- valor
- criado_em
üîê REQUISITOS DE SEGURAN√áA E ESCALABILIDADE
Cada casa tem seus pr√≥prios endpoints (isolamento de URLs)

SubID deve ser √∫nico por afiliado

Toda requisi√ß√£o GET deve ter valida√ß√£o segura

Logs armazenam todos os dados crus (raw_data)

Roteamento din√¢mico com Express Router para cada tipo de evento

üß† EXTRA OPCIONAL
Bot√£o ‚ÄúTestar postback‚Äù com simula√ß√£o no admin

Indicador de quais postbacks j√° receberam chamadas

Op√ß√£o de exportar os logs CSV

‚ö†Ô∏è MUITO IMPORTANTE
‚ö†Ô∏è A IA deve:

Criar apenas os trechos novos relacionados a postback.

N√£o modificar o sistema de links promocionais que j√° est√° funcionando.

Seguir uma estrutura modular, reutiliz√°vel e segura.

Testar com exemplos reais e simular chamadas GET.

