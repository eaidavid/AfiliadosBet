ğŸ› ï¸ 1. Admin configura a casa de apostas no sistema
No painel de admin, vocÃª jÃ¡ tem um formulÃ¡rio para cadastrar casas. Agora, vocÃª precisa de campos especÃ­ficos para os postbacks:

Nome da casa: Ex: Brazzino

Link base de afiliado: Ex: https://brazpromo.com/promo/click/123abc?subid=UNICO123

Token de seguranÃ§a: Ex: abcd123

ParÃ¢metro primÃ¡rio (subid): Ex: subid

Eventos suportados (registro, depÃ³sito, lucro, etc.)

Estrutura de postback esperada por evento:

Ex: /postback/:casa_slug/:evento/:token

O admin entÃ£o comunica Ã  casa o seguinte:

"Nos envie os postbacks nos seguintes links:

Registro: https://afiliadosbet.com/postback/brazzino/registro/abcd123?subid={subid}

DepÃ³sito: https://afiliadosbet.com/postback/brazzino/deposito/abcd123?subid={subid}&valor={amount}"

âœ… ObservaÃ§Ã£o: O sistema monta a URL automaticamente com base nos dados cadastrados.

ğŸ” 2. Sistemas recebem os dados (postbacks)
Cada postback recebido cai em uma rota dinÃ¢mica como:

ruby
Copiar
Editar
GET /postback/:casa/:evento/:token
Exemplo real recebido:

swift
Copiar
Editar
GET /postback/brazzino/deposito/abcd123?subid=abc123&valor=150
ğŸ§© 3. Processo de â€œtransformar dadosâ€ (normalizaÃ§Ã£o e tratamento)
Esse Ã© o passo que vocÃª nÃ£o sabia como expressar â€” o nome disso Ã© normalizaÃ§Ã£o de parÃ¢metros.
Cada casa pode mandar nomes diferentes para os parÃ¢metros (subid, aff_id, amount, val, etc.).

VocÃª precisa de um mapa de parÃ¢metros configurado pelo admin, por exemplo:

json
Copiar
Editar
{
  "subid": "subid",
  "valor": "valor"
}
Outra casa pode ser:

json
Copiar
Editar
{
  "subid": "click_id",
  "valor": "amount"
}
Seu sistema entÃ£o, usa esse mapa para extrair os dados corretamente, independentemente do nome original.

ğŸ“¦ 4. Processamento do evento
ApÃ³s normalizar, o sistema faz:

VerificaÃ§Ã£o do token (comparado com o cadastrado para a casa)

Busca o link no banco com base no subid

Grava o evento na tabela postbacks com:

usuÃ¡rio

casa

evento

valor

subid

parÃ¢metros brutos recebidos

IP

data

Atualiza relatÃ³rios e comissÃµes

Grava o log no painel de postbacks

ğŸ“ 5. Exemplo de log salvo no painel de postbacks
Data	Casa	Evento	Subid	Valor	Status	IP	ParÃ¢metros recebidos
28/05/2025	Brazzino	DepÃ³sito	abc123	150	OK	200.1.1.1	{ subid: 'abc123', valor: '150' }
28/05/2025	Brazzino	Registro	abc123	-	OK	200.1.1.1	{ subid: 'abc123' }

âœ… Resumo dos Componentes a Criar ou Adaptar
ğŸ“Œ No painel do admin:
Campo de mapeamento de parÃ¢metros ({ subid: "subid", valor: "valor" })

GeraÃ§Ã£o automÃ¡tica das URLs de postback por evento

ğŸ“Œ No back-end:
Rota: GET /postback/:casa/:evento/:token

Middleware de validaÃ§Ã£o de token

FunÃ§Ã£o para buscar o mapeamento de parÃ¢metros da casa

FunÃ§Ã£o que normaliza os parÃ¢metros

Registro de evento no banco

Registro de log no painel