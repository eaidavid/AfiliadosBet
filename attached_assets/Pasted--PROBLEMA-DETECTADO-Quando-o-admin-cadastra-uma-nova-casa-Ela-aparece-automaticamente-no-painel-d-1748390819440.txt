â—ï¸PROBLEMA DETECTADO
Quando o admin cadastra uma nova casa:

Ela aparece automaticamente no painel do afiliado como se ele jÃ¡ estivesse afiliado âœ…

O link promocional exibido Ã© o mesmo link genÃ©rico da casa, sem personalizaÃ§Ã£o por afiliado âŒ

ğŸ¯ CAUSA PROVÃVEL
Isso acontece porque:

O sistema estÃ¡ exibindo todas as casas cadastradas como se fossem â€œafiliaÃ§Ãµes ativasâ€ para qualquer usuÃ¡rio.

O link estÃ¡ vindo diretamente da tabela casas, em vez de ser gerado pela relaÃ§Ã£o casa + usuÃ¡rio (afiliado).

NÃ£o estÃ¡ ocorrendo o processo de afiliamento (salvar em afiliacoes ou similar) nem a substituiÃ§Ã£o de parÃ¢metros como subid={id_afiliado}.

âœ… SOLUÃ‡ÃƒO EXATA (em etapas)
1. Separar visualmente no painel do usuÃ¡rio:
Casas disponÃ­veis para se afiliar âœ…

Casas Ã s quais ele jÃ¡ estÃ¡ afiliado âœ…

2. Ao clicar â€œSe afiliarâ€, o sistema deve:
Criar um registro em afiliacoes com:

id_user

id_casa

link_personalizado: gerar substituindo subid=VALUE por subid=<id_user> ou outro identificador Ãºnico

Exibir o link gerado apenas apÃ³s afiliaÃ§Ã£o

3. LÃ³gica do link personalizado:
Se o link base da casa for:

arduino
Copiar
Editar
https://brazzino.com/promo?subid=VALUE
EntÃ£o, para o afiliado com ID 23:

arduino
Copiar
Editar
https://brazzino.com/promo?subid=23
Use essa lÃ³gica para montar o link dinÃ¢mico com base em parÃ¢metros registrados na casa (ex: subid, affid, etc.)

ğŸ”„ AJUSTES NO BACKEND
Ao criar uma casa: nÃ£o gerar vÃ­nculo automÃ¡tico com nenhum afiliado

Criar endpoint POST /afiliar que:

Recebe id_user + id_casa

Gera link personalizado (com o parÃ¢metro primÃ¡rio da casa)

Salva na tabela afiliacoes

Alterar o endpoint que lista casas para o usuÃ¡rio:

Mostrar â€œafiliar-seâ€ se ainda nÃ£o estÃ¡ afiliado

Mostrar link personalizado + botÃ£o â€œdesafiliarâ€ se jÃ¡ estiver afiliado

ğŸ’¡ BONUS: Se quiser padronizar ainda mais...
Adicione um campo parametro_primario e parametros_adicionais no cadastro de casa para automatizar:

json
Copiar
Editar
{
  "parametro_primario": "subid",
  "parametros_adicionais": {
    "utm_source": "afiliadosbet",
    "lang": "pt"
  }
}
E o sistema gera automaticamente:

arduino
Copiar
Editar
https://brazzino.com/promo?subid=23&utm_source=afiliadosbet&lang=pt
